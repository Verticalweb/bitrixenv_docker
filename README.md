# BitrixDocker
Данный репозиторий содержит в себе основные настройки для поднятия Bitrix окружения с помощью докер контейнеров. Для использования достаточно установить Docker на компьютер или серверную машину

## Инструкция

Первым делом выберем папку, где будет храниться наш сайт, а точнее образы, настройки, файлы конфигурации, исходные файлы сайтов, например в *~/docker/*

Затем можно склонировать этот репозиторий себе на машину:
```sh
git clone https://github.com/Verticalweb/bitrixenv_docker.git
```
В текущей директории создасться папка *bitrixenv_docker*, которую желательно переименовать в имя Вашего домена, например **example.com**
```sh
mv bitrixenv_docker example.com
```
Внутри дирректории будут папки *apache, mysql, www*, а так же файлы *docker-compose.yml, example_nginx.com.conf*

Главное, что ннтересует - это файл **docker-compose.yml** - главный файл конфигурации докер. Этот файл имеет достаточное количество комментариев, чтобы в нем мог разобраться даже начинающий разработчик.

Самое основное, что требуется настроить там - это настроить порт (по умолчанию: 8088), на который будет выводиться Ваш сайт, доменное имя, а так же параметры доступа к базе данных.

Отдельно можно произвести настройку php, в дирректории *apache*, настройку mysql в *mysql*, так же отредактировать все файлы конфигурации по собственному усмотрению или требованиям окружения.

##### dump.sql
Если требуется подключить дамп базы данных, то скопируйте этот дамп в корень текущей дирректории, переименнуйте файл на **dump.sql** и раскомментируйте строчку в файле *docker-compose.yml*:
```yaml
volumes:
  # будет доступен, внутри контейнера по адресу /dump.sql
  - ./dump.sql:/dump.sql
```

#### Запуск контейнеров
Для того чтобы осуществить запуск контейнеров, нужно выполнить команду:
```sh
docker-compose up --build &
```
Данная команда соберет и запустит контейнер, если никаких ошибок не возникнет, то сайт, расположенный в дирректории *www*, станет доступен по ардесу **http://example.com:8088**

#### Остановка контейнеров
Для остановки контейнера, необходимо воспользоваться командой
```sh
docker-compose down
```
Данная команда остановит контейнер и удалит собранные временные контейнеры.

#### Вход внутрь контейнера
Для того, чтобы войти внутрь определенного контейнера, нужно узнать имя или идентификатор контейнера, определить идентификаторы запущенных контейнеров можно командой
```sh
docker ps
```
Затем подключиться к терминалу контейнера, например *mysql*, для разворота *dump* необходимо ввести
```sh
docker exec -ti examplecom_mysql_1 /bin/bash
```
Таким образом Вы окажитесь внутри контейнера, где можно уже и развернуть **dump.sql**. 
##### Дополнительно! Развернуть дамп базы!
Развернуть дамп базы данных можно внутри контейнера следующей командой:
```sh
mysql -u MYSQL_USER -pMYSQL_PASSWORD MYSQL_DB < /dump.sql
```
**ВАЖНО!!!** заменить данные *MYSQL_USER, MYSQL_PASSWORD, MYSQL_DB* на значения указанные в *docker-compose.yml* 

### Подключить nginx!
Если в вашей системе уже установлен nginx или в контейнере битрикса или на самой машине, то, для того чтобы сайт мог читаться по 80 порту, доменного имени, необходимо скопировать файл  **example_nginx.com.conf**, предварительно отредактировав его под свои параметры (доменное имя, порт контейнера) в дирректорию с настройками сайтов nginx, обычно это */etc/nginx/conf.d* (если nginx вне контейнеров) и перезагрузить nginx, чтобы он смог прочитать новые файлы конфигурации.

Если в вашей системе не установлен nginx, то Вы можете его установить воспользовавшись нашим контейнером [NginxDocker](https://github.com/Verticalweb/nginx_docker).